#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –∫—Ä–∏–ø—Ç–æ –æ–±–º–µ–Ω–Ω–∏–∫–∞ –≤ ICP –∫–∞–Ω–∏—Å—Ç—Ä—É

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –∫—Ä–∏–ø—Ç–æ –æ–±–º–µ–Ω–Ω–∏–∫–∞ –≤ ICP –∫–∞–Ω–∏—Å—Ç—Ä—É..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ dfx —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if ! command -v dfx &> /dev/null; then
    echo "‚ùå dfx –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ dfx: https://internetcomputer.org/docs/current/developer-docs/setup/install/"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏
echo "üì° –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ IC..."
dfx ping ic

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
npm run build

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ build –ø–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if [ ! -d "build" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–∞–ø–∫–∞ build –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏"
    exit 1
fi

# –î–µ–ø–ª–æ–∏–º –≤ –∫–∞–Ω–∏—Å—Ç—Ä—É
echo "üöÄ –î–µ–ø–ª–æ–∏–º –≤ –∫–∞–Ω–∏—Å—Ç—Ä—É..."
dfx deploy --network ic

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
echo "üåê –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: https://$(dfx canister --network ic id crypto-exchange-app).ic0.app" 