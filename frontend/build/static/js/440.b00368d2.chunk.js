/*! For license information please see 440.b00368d2.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkcrypto_exchange_app=self.webpackChunkcrypto_exchange_app||[]).push([[440],{3440:(e,t,r)=>{r.r(t),r.d(t,{AuthClient:()=>qe,ERROR_USER_INTERRUPT:()=>Ue,IdbKeyVal:()=>Pe,IdbStorage:()=>Ne,IdleManager:()=>ue,KEY_STORAGE_DELEGATION:()=>ze,KEY_STORAGE_KEY:()=>je,LocalStorage:()=>Le});var n=r(5914),i=r(9883),o=r(8898),a=r(4910),s=r(3653),c=r(967);const l=BigInt(0),u=BigInt(1),d=BigInt(2),f=BigInt(8),h={zip215:!0};function y(e){const t=function(e){const t=(0,c.h)(e);return s.Q5(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:r,n:n,prehash:i,hash:o,randomBytes:y,nByteLength:g,h:w}=t,p=d<<BigInt(8*g)-u,v=r.create,m=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:r.sqrt(e*r.inv(t))}}catch(n){return{isValid:!1,value:l}}}),b=t.adjustScalarBytes||(e=>e),E=t.domain||((e,t,r)=>{if(t.length||r)throw new Error("Contexts/pre-hash are not supported");return e}),_=e=>"bigint"===typeof e&&l<e,I=(e,t)=>_(e)&&_(t)&&e<t,x=e=>e===l||I(e,p);function S(e,t){if(I(e,t))return e;throw new Error(`Expected valid scalar < ${t}, got ${typeof e} ${e}`)}function D(e){return e===l?e:S(e,n)}const B=new Map;function A(e){if(!(e instanceof T))throw new Error("ExtendedPoint expected")}class T{constructor(e,t,r,n){if(this.ex=e,this.ey=t,this.ez=r,this.et=n,!x(e))throw new Error("x required");if(!x(t))throw new Error("y required");if(!x(r))throw new Error("z required");if(!x(n))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof T)throw new Error("extended point not allowed");const{x:t,y:r}=e||{};if(!x(t)||!x(r))throw new Error("invalid affine point");return new T(t,r,u,v(t*r))}static normalizeZ(e){const t=r.invertBatch(e.map(e=>e.ez));return e.map((e,r)=>e.toAffine(t[r])).map(T.fromAffine)}_setWindowSize(e){this._WINDOW_SIZE=e,B.delete(this)}assertValidity(){const{a:e,d:r}=t;if(this.is0())throw new Error("bad point: ZERO");const{ex:n,ey:i,ez:o,et:a}=this,s=v(n*n),c=v(i*i),l=v(o*o),u=v(l*l),d=v(s*e);if(v(l*v(d+c))!==v(u+v(r*v(s*c))))throw new Error("bad point: equation left != right (1)");if(v(n*i)!==v(o*a))throw new Error("bad point: equation left != right (2)")}equals(e){A(e);const{ex:t,ey:r,ez:n}=this,{ex:i,ey:o,ez:a}=e,s=v(t*a),c=v(i*n),l=v(r*a),u=v(o*n);return s===c&&l===u}is0(){return this.equals(T.ZERO)}negate(){return new T(v(-this.ex),this.ey,this.ez,v(-this.et))}double(){const{a:e}=t,{ex:r,ey:n,ez:i}=this,o=v(r*r),a=v(n*n),s=v(d*v(i*i)),c=v(e*o),l=r+n,u=v(v(l*l)-o-a),f=c+a,h=f-s,y=c-a,g=v(u*h),w=v(f*y),p=v(u*y),m=v(h*f);return new T(g,w,m,p)}add(e){A(e);const{a:r,d:n}=t,{ex:i,ey:o,ez:a,et:s}=this,{ex:c,ey:u,ez:f,et:h}=e;if(r===BigInt(-1)){const e=v((o-i)*(u+c)),t=v((o+i)*(u-c)),r=v(t-e);if(r===l)return this.double();const n=v(a*d*h),y=v(s*d*f),g=y+n,w=t+e,p=y-n,m=v(g*r),b=v(w*p),E=v(g*p),_=v(r*w);return new T(m,b,_,E)}const y=v(i*c),g=v(o*u),w=v(s*n*h),p=v(a*f),m=v((i+o)*(c+u)-y-g),b=p-w,E=p+w,_=v(g-r*y),I=v(m*b),x=v(E*_),S=v(m*_),D=v(b*E);return new T(I,x,D,S)}subtract(e){return this.add(e.negate())}wNAF(e){return O.wNAFCached(this,B,e,T.normalizeZ)}multiply(e){const{p:t,f:r}=this.wNAF(S(e,n));return T.normalizeZ([t,r])[0]}multiplyUnsafe(e){let t=D(e);return t===l?K:this.equals(K)||t===u?this:this.equals(P)?this.wNAF(t).p:O.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(w).is0()}isTorsionFree(){return O.unsafeLadder(this,n).is0()}toAffine(e){const{ex:t,ey:n,ez:i}=this,o=this.is0();null==e&&(e=o?f:r.inv(i));const a=v(t*e),s=v(n*e),c=v(i*e);if(o)return{x:l,y:u};if(c!==u)throw new Error("invZ was invalid");return{x:a,y:s}}clearCofactor(){const{h:e}=t;return e===u?this:this.multiplyUnsafe(e)}static fromHex(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{d:i,a:o}=t,a=r.BYTES,c=(e=(0,s.qj)("pointHex",e,a)).slice(),d=e[a-1];c[a-1]=-129&d;const f=s.lX(c);f===l||S(f,n?p:r.ORDER);const h=v(f*f),y=v(h-u),g=v(i*h-o);let{isValid:w,value:b}=m(y,g);if(!w)throw new Error("Point.fromHex: invalid y coordinate");const E=(b&u)===u,_=0!==(128&d);if(!n&&b===l&&_)throw new Error("Point.fromHex: x=0 and x_0=1");return _!==E&&(b=v(-b)),T.fromAffine({x:b,y:f})}static fromPrivateKey(e){return z(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),n=s.z(t,r.BYTES);return n[n.length-1]|=e&u?128:0,n}toHex(){return s.My(this.toRawBytes())}}T.BASE=new T(t.Gx,t.Gy,u,v(t.Gx*t.Gy)),T.ZERO=new T(l,u,u,l);const{BASE:P,ZERO:K}=T,O=(0,c.A)(T,8*g);function k(e){return(0,a.zi)(e,n)}function j(e){return k(s.lX(e))}function z(e){const t=g;e=(0,s.qj)("private key",e,t);const r=(0,s.qj)("hashed private key",o(e),2*t),n=b(r.slice(0,t)),i=r.slice(t,2*t),a=j(n),c=P.multiply(a),l=c.toRawBytes();return{head:n,prefix:i,scalar:a,point:c,pointBytes:l}}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const a=s.Id(...r);return j(o(E(a,(0,s.qj)("context",e),!!i)))}const R=h;P._setWindowSize(8);const L={getExtendedPublicKey:z,randomPrivateKey:()=>y(r.BYTES),precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};return{CURVE:t,getPublicKey:function(e){return z(e).pointBytes},sign:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=(0,s.qj)("message",e),i&&(e=i(e));const{prefix:o,scalar:a,pointBytes:c}=z(t),l=C(n.context,o,e),u=P.multiply(l).toRawBytes(),d=k(l+C(n.context,u,c,e)*a);D(d);const f=s.Id(u,s.z(d,r.BYTES));return(0,s.qj)("result",f,2*g)},verify:function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R;const{context:a,zip215:c}=o,l=r.BYTES;e=(0,s.qj)("signature",e,2*l),t=(0,s.qj)("message",t),i&&(t=i(t));const u=s.lX(e.slice(l,2*l));let d,f,h;try{d=T.fromHex(n,c),f=T.fromHex(e.slice(0,l),c),h=P.multiplyUnsafe(u)}catch(g){return!1}if(!c&&d.isSmallOrder())return!1;const y=C(a,f.toRawBytes(),d.toRawBytes(),t);return f.add(d.multiplyUnsafe(y)).subtract(h).clearCofactor().equals(T.ZERO)},ExtendedPoint:T,utils:L}}const g=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),w=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),p=(BigInt(0),BigInt(1)),v=BigInt(2),m=BigInt(5),b=BigInt(10),E=BigInt(20),_=BigInt(40),I=BigInt(80);function x(e){const t=g,r=e*e%t*e%t,n=(0,a.zH)(r,v,t)*r%t,i=(0,a.zH)(n,p,t)*e%t,o=(0,a.zH)(i,m,t)*i%t,s=(0,a.zH)(o,b,t)*o%t,c=(0,a.zH)(s,E,t)*s%t,l=(0,a.zH)(c,_,t)*c%t,u=(0,a.zH)(l,I,t)*l%t,d=(0,a.zH)(u,I,t)*l%t,f=(0,a.zH)(d,b,t)*o%t;return{pow_p_5_8:(0,a.zH)(f,v,t)*e%t,b2:r}}function S(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function D(e,t){const r=g,n=(0,a.zi)(t*t*t,r),i=x(e*(0,a.zi)(n*n*t,r)).pow_p_5_8;let o=(0,a.zi)(e*n*i,r);const s=(0,a.zi)(t*o*o,r),c=o,l=(0,a.zi)(o*w,r),u=s===e,d=s===(0,a.zi)(-e,r),f=s===(0,a.zi)(-e*w,r);return u&&(o=c),(d||f)&&(o=l),(0,a.dQ)(o,r)&&(o=(0,a.zi)(-o,r)),{isValid:u||d,value:o}}const B=(0,a.D0)(g,void 0,!0),A={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:B,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:i.Zf,randomBytes:o.po,adjustScalarBytes:S,uvRatio:D},T=y(A);function P(e,t,r){if(t.length>255)throw new Error("Context is too big");return(0,o.Id)((0,o.AI)("SigEd25519 no Ed25519 collisions"),new Uint8Array([r?1:0,t.length]),t,e)}i.Zf;const K=(B.ORDER+BigInt(3))/BigInt(8);B.pow(v,K),B.sqrt(B.neg(B.ONE)),B.ORDER,BigInt(5),BigInt(8),BigInt(486662);(0,a.Tv)(B,B.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var O,k,j,z,C=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},R=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};function L(e){return null!==e&&"object"===typeof e}class N{constructor(e){if(O.set(this,void 0),k.set(this,void 0),e.byteLength!==N.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");C(this,O,(0,n.em)(e),"f"),C(this,k,N.derEncode(e),"f")}static from(e){if("string"===typeof e){const t=(0,n.aD)(e);return this.fromRaw(t)}if(L(e)){const t=e;if(L(t)&&Object.hasOwnProperty.call(t,"__derEncodedPublicKey__"))return this.fromDer(t);if(ArrayBuffer.isView(t)){const e=t;return this.fromRaw((0,n.em)(e.buffer))}if(t instanceof ArrayBuffer)return this.fromRaw(t);if("rawKey"in t)return this.fromRaw(t.rawKey);if("derKey"in t)return this.fromDer(t.derKey);if("toDer"in t)return this.fromDer(t.toDer())}throw new Error("Cannot construct Ed25519PublicKey from the provided key.")}static fromRaw(e){return new N(e)}static fromDer(e){return new N(this.derDecode(e))}static derEncode(e){const t=(0,n.C2)(e,n.le).buffer;return t.__derEncodedPublicKey__=void 0,t}static derDecode(e){const t=(0,n.n9)(e,n.le);if(t.length!==this.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");return(0,n.em)(t)}get rawKey(){return R(this,O,"f")}get derKey(){return R(this,k,"f")}toDer(){return this.derKey}toRaw(){return this.rawKey}}O=new WeakMap,k=new WeakMap,N.RAW_KEY_LENGTH=32;class H extends n.A4{constructor(e,t){super(),j.set(this,void 0),z.set(this,void 0),C(this,j,N.from(e),"f"),C(this,z,new Uint8Array(t),"f")}static generate(e){if(e&&32!==e.length)throw new Error("Ed25519 Seed needs to be 32 bytes long.");e||(e=T.utils.randomPrivateKey()),(0,n.HA)(e,new Uint8Array(new Array(32).fill(0)))&&console.warn("Seed is all zeros. This is not a secure seed. Please provide a seed with sufficient entropy if this is a production environment.");const t=new Uint8Array(32);for(let n=0;n<32;n++)t[n]=new Uint8Array(e)[n];const r=T.getPublicKey(t);return H.fromKeyPair(r,t)}static fromParsedJson(e){const[t,r]=e;return new H(N.fromDer((0,n.aD)(t)),(0,n.aD)(r))}static fromJSON(e){const t=JSON.parse(e);if(Array.isArray(t)){if("string"===typeof t[0]&&"string"===typeof t[1])return this.fromParsedJson([t[0],t[1]]);throw new Error("Deserialization error: JSON must have at least 2 items.")}throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(e)}`)}static fromKeyPair(e,t){return new H(N.fromRaw(e),t)}static fromSecretKey(e){const t=T.getPublicKey(new Uint8Array(e));return H.fromKeyPair(t,e)}toJSON(){return[(0,n.nj)(R(this,j,"f").toDer()),(0,n.nj)(R(this,z,"f"))]}getKeyPair(){return{secretKey:R(this,z,"f"),publicKey:R(this,j,"f")}}getPublicKey(){return R(this,j,"f")}async sign(e){const t=new Uint8Array(e),r=(0,n.Nn)(T.sign(t,R(this,z,"f").slice(0,32)));return Object.defineProperty(r,"__signature__",{enumerable:!1,value:void 0}),r}static verify(e,t,r){const[i,o,a]=[e,t,r].map(e=>("string"===typeof e&&(e=(0,n.aD)(e)),e instanceof Uint8Array&&(e=(0,n.em)(e.buffer)),new Uint8Array(e)));return T.verify(i,o,a)}}j=new WeakMap,z=new WeakMap;class W extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,W.prototype)}}function U(e){if("undefined"!==typeof r.g&&r.g.crypto&&r.g.crypto.subtle)return r.g.crypto.subtle;if(e)return e;if("undefined"!==typeof crypto&&crypto.subtle)return crypto.subtle;throw new W("Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto")}class q extends n.A4{constructor(e,t,r){super(),this._keyPair=e,this._derKey=t,this._subtleCrypto=r}static async generate(e){const{extractable:t=!1,keyUsages:r=["sign","verify"],subtleCrypto:n}=null!==e&&void 0!==e?e:{},i=U(n),o=await i.generateKey({name:"ECDSA",namedCurve:"P-256"},t,r);return new this(o,await i.exportKey("spki",o.publicKey),i)}static async fromKeyPair(e,t){const r=U(t),n=await r.exportKey("spki",e.publicKey);return new q(e,n,r)}getKeyPair(){return this._keyPair}getPublicKey(){const e=this._derKey,t=Object.create(this._keyPair.publicKey);return t.toDer=function(){return e},t}async sign(e){return await this._subtleCrypto.sign({name:"ECDSA",hash:{name:"SHA-256"}},this._keyPair.privateKey,e)}}var M,J=r(635),G=r(4505),V=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},F=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class Y{constructor(e){M.set(this,void 0),V(this,M,e,"f")}get rawKey(){return F(this,M,"f").rawKey}get derKey(){return F(this,M,"f").derKey}toDer(){return F(this,M,"f").toDer()}getPublicKey(){return F(this,M,"f")}getPrincipal(){if(!F(this,M,"f").rawKey)throw new Error("Cannot get principal from a public key without a raw key.");return J.p.fromUint8Array(new Uint8Array(F(this,M,"f").rawKey))}transformRequest(){return Promise.reject("Not implemented. You are attempting to use a partial identity to sign calls, but this identity only has access to the public key.To sign calls, use a DelegationIdentity instead.")}}M=new WeakMap;var Z,$=r(5447),X=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},Q=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},ee=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const te=(new TextEncoder).encode("\x1aic-request-auth-delegation"),re=(new TextEncoder).encode("\nic-request");function ne(e){if("string"!==typeof e||e.length<64)throw new Error("Invalid public key.");return(0,n.aD)(e)}class ie{constructor(e,t,r){this.pubkey=e,this.expiration=t,this.targets=r}toCBOR(){return G.value.map(Object.assign({pubkey:G.value.bytes(this.pubkey),expiration:G.value.u64(this.expiration.toString(16),16)},this.targets&&{targets:G.value.array(this.targets.map(e=>G.value.bytes((0,$.em)(e.toUint8Array()))))}))}toJSON(){return Object.assign({expiration:this.expiration.toString(16),pubkey:(0,n.nj)(this.pubkey)},this.targets&&{targets:this.targets.map(e=>e.toHex())})}}class oe{constructor(e,t){this.delegations=e,this.publicKey=t}static async create(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date(Date.now()+9e5),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var o,a;const s=await async function(e,t,r,i){const o=new ie(t.toDer(),BigInt(+r)*BigInt(1e6),i),a=new Uint8Array([...te,...new Uint8Array((0,n.Gb)(Object.assign({},o)))]);return{delegation:o,signature:await e.sign((0,$.em)(a))}}(e,t,r,i.targets);return new oe([...(null===(o=i.previous)||void 0===o?void 0:o.delegations)||[],s],(null===(a=i.previous)||void 0===a?void 0:a.publicKey)||e.getPublicKey().toDer())}static fromJSON(e){const{publicKey:t,delegations:r}="string"===typeof e?JSON.parse(e):e;if(!Array.isArray(r))throw new Error("Invalid delegations.");return new this(r.map(e=>{const{delegation:t,signature:r}=e,{pubkey:n,expiration:i,targets:o}=t;if(void 0!==o&&!Array.isArray(o))throw new Error("Invalid targets.");return{delegation:new ie(ne(n),BigInt("0x"+i),o&&o.map(e=>{if("string"!==typeof e)throw new Error("Invalid target.");return J.p.fromHex(e)})),signature:ne(r)}}),ne(t))}static fromDelegations(e,t){return new this(e,t)}toJSON(){return{delegations:this.delegations.map(e=>{const{delegation:t,signature:r}=e,{targets:i}=t;return{delegation:Object.assign({expiration:t.expiration.toString(16),pubkey:(0,n.nj)(t.pubkey)},i&&{targets:i.map(e=>e.toHex())}),signature:(0,n.nj)(r)}}),publicKey:(0,n.nj)(this.publicKey)}}}class ae extends n.A4{constructor(e,t){super(),this._inner=e,this._delegation=t}static fromDelegation(e,t){return new this(e,t)}getDelegation(){return this._delegation}getPublicKey(){return{derKey:this._delegation.publicKey,toDer:()=>this._delegation.publicKey}}sign(e){return this._inner.sign(e)}async transformRequest(e){const{body:t}=e,r=ee(e,["body"]),i=await(0,n.Gb)(t);return Object.assign(Object.assign({},r),{body:{content:t,sender_sig:await this.sign((0,$.em)(new Uint8Array([...re,...new Uint8Array(i)]))),sender_delegation:this._delegation.delegations,sender_pubkey:this._delegation.publicKey}})}}class se extends Y{constructor(e,t){super(e),Z.set(this,void 0),X(this,Z,t,"f")}get delegation(){return Q(this,Z,"f")}static fromDelegation(e,t){return new se(e,t)}}Z=new WeakMap;var ce;r(2074);!function(e){e[e.ECDSA_WITH_SHA256=-7]="ECDSA_WITH_SHA256"}(ce||(ce={}));n.A4;const le=["mousedown","mousemove","keydown","touchstart","wheel"];class ue{constructor(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var r;this.callbacks=[],this.idleTimeout=6e5,this.timeoutID=void 0;const{onIdle:n,idleTimeout:i=6e5}=t||{};this.callbacks=n?[n]:[],this.idleTimeout=i;const o=this._resetTimer.bind(this);window.addEventListener("load",o,!0),le.forEach(function(e){document.addEventListener(e,o,!0)});if(null===t||void 0===t?void 0:t.captureScroll){const n=((t,r)=>{let n;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];const s=e;clearTimeout(n),n=window.setTimeout(function(){n=void 0,t.apply(s,o)},r)}})(o,null!==(r=null===t||void 0===t?void 0:t.scrollDebounce)&&void 0!==r?r:100);window.addEventListener("scroll",n,!0)}o()}static create(){return new this(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}registerCallback(e){this.callbacks.push(e)}exit(){clearTimeout(this.timeoutID),window.removeEventListener("load",this._resetTimer,!0);const e=this._resetTimer.bind(this);le.forEach(function(t){document.removeEventListener(t,e,!0)}),this.callbacks.forEach(e=>e())}_resetTimer(){const e=this.exit.bind(this);window.clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout(e,this.idleTimeout)}}let de,fe;const he=new WeakMap,ye=new WeakMap,ge=new WeakMap,we=new WeakMap,pe=new WeakMap;let ve={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ye.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ge.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ee(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function me(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(fe||(fe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(_e(this),r),Ee(he.get(this))}:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return Ee(e.apply(_e(this),r))}:function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];const o=e.call(_e(this),t,...n);return ge.set(o,t.sort?t.sort():[t]),Ee(o)}}function be(e){return"function"===typeof e?me(e):(e instanceof IDBTransaction&&function(e){if(ye.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),n()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});ye.set(e,t)}(e),t=e,(de||(de=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,ve):e);var t}function Ee(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(Ee(e.result)),n()},o=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&he.set(t,e)}).catch(()=>{}),pe.set(t,e),t}(e);if(we.has(e))return we.get(e);const t=be(e);return t!==e&&(we.set(e,t),pe.set(t,e)),t}const _e=e=>pe.get(e);const Ie=["get","getKey","getAll","getAllKeys","count"],xe=["put","add","delete","clear"],Se=new Map;function De(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Se.get(t))return Se.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=xe.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!Ie.includes(r))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];return n&&(o=o.index(s.shift())),(await Promise.all([o[r](...s),i&&t.done]))[0]};return Se.set(t,o),o}ve=(e=>({...e,get:(t,r,n)=>De(t,r)||e.get(t,r,n),has:(t,r)=>!!De(t,r)||e.has(t,r)}))(ve);const Be="auth-client-db",Ae="ic-keyval",Te=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Be,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ae,r=arguments.length>2?arguments[2]:void 0;return Re&&(null===localStorage||void 0===localStorage?void 0:localStorage.getItem(ze))&&(localStorage.removeItem(ze),localStorage.removeItem(je)),await function(e,t){let{blocked:r,upgrade:n,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),s=Ee(a);return n&&a.addEventListener("upgradeneeded",e=>{n(Ee(a.result),e.oldVersion,e.newVersion,Ee(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}(e,r,{upgrade:e=>{e.objectStoreNames.contains(t)&&e.clear(t),e.createObjectStore(t)}})};class Pe{constructor(e,t){this._db=e,this._storeName=t}static async create(e){const{dbName:t=Be,storeName:r=Ae,version:n=Ce}=null!==e&&void 0!==e?e:{},i=await Te(t,r,n);return new Pe(i,r)}async set(e,t){return await async function(e,t,r,n){return await e.put(t,n,r)}(this._db,this._storeName,e,t)}async get(e){var t;return null!==(t=await async function(e,t,r){return await e.get(t,r)}(this._db,this._storeName,e))&&void 0!==t?t:null}async remove(e){return await async function(e,t,r){return await e.delete(t,r)}(this._db,this._storeName,e)}}var Ke,Oe=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},ke=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};const je="identity",ze="delegation",Ce=1,Re="undefined"!==typeof window;class Le{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ic-",t=arguments.length>1?arguments[1]:void 0;this.prefix=e,this._localStorage=t}get(e){return Promise.resolve(this._getLocalStorage().getItem(this.prefix+e))}set(e,t){return this._getLocalStorage().setItem(this.prefix+e,t),Promise.resolve()}remove(e){return this._getLocalStorage().removeItem(this.prefix+e),Promise.resolve()}_getLocalStorage(){if(this._localStorage)return this._localStorage;const e="undefined"===typeof window?"undefined"===typeof r.g?"undefined"===typeof self?void 0:self.localStorage:r.g.localStorage:window.localStorage;if(!e)throw new Error("Could not find local storage.");return e}}class Ne{constructor(e){Ke.set(this,void 0),Oe(this,Ke,null!==e&&void 0!==e?e:{},"f")}get _db(){return new Promise(e=>{this.initializedDb?e(this.initializedDb):Pe.create(ke(this,Ke,"f")).then(t=>{this.initializedDb=t,e(t)})})}async get(e){const t=await this._db;return await t.get(e)}async set(e,t){const r=await this._db;await r.set(e,t)}async remove(e){const t=await this._db;await t.remove(e)}}Ke=new WeakMap;const He="ECDSA",We="Ed25519",Ue="UserInterrupt";class qe{constructor(e,t,r,n,i,o,a,s){this._identity=e,this._key=t,this._chain=r,this._storage=n,this.idleManager=i,this._createOptions=o,this._idpWindow=a,this._eventHandler=s,this._registerDefaultIdleCallback()}static async create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t,r,i;const o=null!==(t=e.storage)&&void 0!==t?t:new Ne,a=null!==(r=e.keyType)&&void 0!==r?r:He;let s=null;if(e.identity)s=e.identity;else{let e=await o.get(je);if(!e&&Re)try{const t=new Le,r=await t.get(ze),n=await t.get(je);r&&n&&a===He&&(console.log("Discovered an identity stored in localstorage. Migrating to IndexedDB"),await o.set(ze,r),await o.set(je,n),e=r,await t.remove(ze),await t.remove(je))}catch(d){console.error("error while attempting to recover localstorage: "+d)}if(e)try{"object"===typeof e?s=a===We&&"string"===typeof e?await H.fromJSON(e):await q.fromKeyPair(e):"string"===typeof e&&(s=H.fromJSON(e))}catch(f){}}let c,l=new n.mC,u=null;if(s)try{const t=await o.get(ze);if("object"===typeof t&&null!==t)throw new Error("Delegation chain is incorrectly stored. A delegation chain should be stored as a string.");e.identity?l=e.identity:t&&(u=oe.fromJSON(t),!function(e,t){for(const{delegation:i}of e.delegations)if(+new Date(Number(i.expiration/BigInt(1e6)))<=+Date.now())return!1;const r=[],n=null===t||void 0===t?void 0:t.scope;n&&(Array.isArray(n)?r.push(...n.map(e=>"string"===typeof e?J.p.fromText(e):e)):r.push("string"===typeof n?J.p.fromText(n):n));for(const i of r){const t=i.toText();for(const{delegation:r}of e.delegations){if(void 0===r.targets)continue;let e=!0;for(const n of r.targets)if(n.toText()===t){e=!1;break}if(e)return!1}}return!0}(u)?(await Me(o),s=null):l="toDer"in s?se.fromDelegation(s,u):ae.fromDelegation(s,u))}catch(h){console.error(h),await Me(o),s=null}return(null===(i=e.idleOptions)||void 0===i?void 0:i.disableIdle)?c=void 0:(u||e.identity)&&(c=ue.create(e.idleOptions)),s||(a===We?(s=await H.generate(),await o.set(je,JSON.stringify(s.toJSON()))):(e.storage&&a===He&&console.warn(`You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${We}' as the key type, as it can serialize to a string`),s=await q.generate(),await o.set(je,s.getKeyPair()))),new this(l,s,u,o,c,e)}_registerDefaultIdleCallback(){var e,t;const r=null===(e=this._createOptions)||void 0===e?void 0:e.idleOptions;(null===r||void 0===r?void 0:r.onIdle)||(null===r||void 0===r?void 0:r.disableDefaultIdleCallback)||null===(t=this.idleManager)||void 0===t||t.registerCallback(()=>{this.logout(),location.reload()})}async _handleSuccess(e,t){var r,n;const i=e.delegations.map(e=>({delegation:new ie(e.delegation.pubkey,e.delegation.expiration,e.delegation.targets),signature:e.signature.buffer})),o=oe.fromDelegations(i,e.userPublicKey.buffer),a=this._key;if(!a)return;this._chain=o,this._identity="toDer"in a?se.fromDelegation(a,this._chain):ae.fromDelegation(a,this._chain),null===(r=this._idpWindow)||void 0===r||r.close();const s=null===(n=this._createOptions)||void 0===n?void 0:n.idleOptions;this.idleManager||(null===s||void 0===s?void 0:s.disableIdle)||(this.idleManager=ue.create(s),this._registerDefaultIdleCallback()),this._removeEventListener(),delete this._idpWindow,this._chain&&await this._storage.set(ze,JSON.stringify(this._chain.toJSON())),null===t||void 0===t||t(e)}getIdentity(){return this._identity}async isAuthenticated(){return!this.getIdentity().getPrincipal().isAnonymous()&&null!==this._chain}async login(e){var t,r,n,i;const o=BigInt(8)*BigInt(36e11),a=new URL((null===(t=null===e||void 0===e?void 0:e.identityProvider)||void 0===t?void 0:t.toString())||"https://identity.internetcomputer.org");a.hash="#authorize",null===(r=this._idpWindow)||void 0===r||r.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(a,Object.assign({maxTimeToLive:null!==(n=null===e||void 0===e?void 0:e.maxTimeToLive)&&void 0!==n?n:o},e)),window.addEventListener("message",this._eventHandler),this._idpWindow=null!==(i=window.open(a.toString(),"idpWindow",null===e||void 0===e?void 0:e.windowOpenerFeatures))&&void 0!==i?i:void 0;const s=()=>{this._idpWindow&&(this._idpWindow.closed?this._handleFailure(Ue,null===e||void 0===e?void 0:e.onError):setTimeout(s,500))};s()}_getEventHandler(e,t){return async r=>{var n,i,o;if(r.origin!==e.origin)return;const a=r.data;switch(a.kind){case"authorize-ready":{const r=Object.assign({kind:"authorize-client",sessionPublicKey:new Uint8Array(null===(n=this._key)||void 0===n?void 0:n.getPublicKey().toDer()),maxTimeToLive:null===t||void 0===t?void 0:t.maxTimeToLive,allowPinAuthentication:null===t||void 0===t?void 0:t.allowPinAuthentication,derivationOrigin:null===(i=null===t||void 0===t?void 0:t.derivationOrigin)||void 0===i?void 0:i.toString()},null===t||void 0===t?void 0:t.customValues);null===(o=this._idpWindow)||void 0===o||o.postMessage(r,e.origin);break}case"authorize-client-success":try{await this._handleSuccess(a,null===t||void 0===t?void 0:t.onSuccess)}catch(s){this._handleFailure(s.message,null===t||void 0===t?void 0:t.onError)}break;case"authorize-client-failure":this._handleFailure(a.text,null===t||void 0===t?void 0:t.onError)}}}_handleFailure(e,t){var r;null===(r=this._idpWindow)||void 0===r||r.close(),null===t||void 0===t||t(e),this._removeEventListener(),delete this._idpWindow}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}async logout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(await Me(this._storage),this._identity=new n.mC,this._chain=null,e.returnTo)try{window.history.pushState({},"",e.returnTo)}catch(t){window.location.href=e.returnTo}}}async function Me(e){await e.remove(je),await e.remove(ze),await e.remove("iv")}}}]);